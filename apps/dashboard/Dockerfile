# syntax=docker/dockerfile:1.11
# This file is generated by Dofigen v2.5.0
# See https://github.com/lenra-io/dofigen

# pnpm
FROM node@sha256:d943bf20249f8b92eff6f605362df2ee9cf2d6ce2ea771a8886e126ec8714f08 AS pnpm
LABEL \
    org.opencontainers.image.base.digest="sha256:d943bf20249f8b92eff6f605362df2ee9cf2d6ce2ea771a8886e126ec8714f08" \
    org.opencontainers.image.base.name="docker.io/node:22-slim"
ENV \
    PATH="$PNPM_HOME:$PATH" \
    PNPM_HOME="/pnpm"
WORKDIR /app/
COPY \
    --link \
    "." "/app/"
RUN corepack enable

# install
FROM pnpm AS install
WORKDIR /app/apps/dashboard
COPY \
    --from=pnpm \
    --link \
    "/app/" "/app/"
RUN \
    --mount=type=cache,target=/pnpm/store,sharing=locked \
    pnpm install --frozen-lockfile

# runtime
FROM pnpm AS runtime
LABEL io.dofigen.version="2.5.0"
WORKDIR /app/apps/dashboard
COPY \
    --from=install \
    --chown=1000:1000 \
    --link \
    "/app/" "/app/"
USER 1000:1000
EXPOSE 3000
CMD ["pnpm", "dev"]
