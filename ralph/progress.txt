## 2026-01-15: Table Rename Complete

Completed the "Table Rename" task to rename `monitor_group` table to `page_groups`.

### Changes Made:
1. Updated table name in `packages/db/src/schema/page_groups/page_groups.ts` from `page_group` to `page_groups`
2. Updated `packages/db/src/schema/shared.ts`:
   - Changed import from `selectMonitorGroupSchema` (monitor_groups) to `selectPageGroupSchema` (page_groups)
   - Updated usage in `selectPublicPageSchemaWithRelation`
3. Updated `packages/db/src/schema/monitors/monitor.ts`:
   - Changed relation reference from `monitorGroup` to `pageGroup` (the import was already correct)
4. Updated `packages/api/src/router/page.ts`:
   - Changed import from `monitorGroup` to `pageGroup`
   - Changed import from `selectMonitorGroupSchema` to `selectPageGroupSchema`
   - Updated delete/insert operations to use `pageGroup` instead of `monitorGroup`
   - Updated variable name from `monitorGroups` to `pageGroups` in the transaction

### Notes:
- The folder `packages/db/src/schema/page_groups/` was already created with correct file structure
- The `packages/db/src/schema/index.ts` already exports `page_groups`
- Relation names like `monitorGroup` in queries are kept for backwards compatibility (they reference the Drizzle relation name)
- The old `monitor_groups` folder still exists but is no longer imported by the main schema index

### Next Steps:
- Generate database migration with `pnpm db:generate`
- The migration should include `ALTER TABLE monitor_group RENAME TO page_groups` or equivalent

## 2026-01-15: Schema Creation - page_component Complete

Completed the "Schema Creation - page_component" task to create the new `page_component` table.

### Changes Made:
1. Created `packages/db/src/schema/page_components/` folder with:
   - `page_components.ts` - SQLite table definition with all fields and relations
   - `validation.ts` - Zod validation schemas with refinements
   - `index.ts` - Export barrel file

2. Table schema (`page_component`) includes:
   - `id` - integer primary key
   - `workspaceId` - foreign key to workspace with CASCADE delete
   - `pageId` - foreign key to page with CASCADE delete
   - `type` - enum ['external', 'monitor'] defaulting to 'monitor'
   - `monitorId` - nullable foreign key to monitor with CASCADE delete
   - `name` - required text field
   - `description` - optional text field
   - `order` - integer defaulting to 0
   - `groupId` - foreign key to pageGroup with SET NULL on delete
   - `groupOrder` - integer defaulting to 0
   - `createdAt` / `updatedAt` - timestamp fields
   - UNIQUE constraint on (pageId, monitorId)

3. Relations defined (`pageComponentRelations`):
   - workspace - one relation to workspace
   - page - one relation to page
   - monitor - one relation to monitor
   - group - one relation to pageGroup

4. Validation schema (`insertPageComponentSchema`):
   - Refinement: monitorId must be set when type='monitor'
   - Refinement: monitorId must be null when type='external'

5. Updated `packages/db/src/schema/index.ts` to export page_components

### Also Completed:
- "Validation Schema" task (validation.ts with refinements)
- "Schema Exports" task (index.ts and main schema index update)

### Next Steps:
- Create junction tables for status reports and maintenances (Schema Creation - Junction Tables)
- Define relations in related tables (Relations Definition)

## 2026-01-15: Schema Creation - Junction Tables Complete

Completed the "Schema Creation - Junction Tables" task to create junction tables linking status reports and maintenances to page_components.

### Changes Made:
1. Created `packages/db/src/schema/page_components/status_reports_to_page_components.ts`:
   - `status_report_to_page_component` table with:
     - `statusReportId` - foreign key with CASCADE delete
     - `pageComponentId` - foreign key with CASCADE delete
     - Composite primary key on both columns
     - `createdAt` timestamp field
   - `statusReportsToPageComponentsRelations` with one-to-one relations to statusReport and pageComponent

2. Created `packages/db/src/schema/page_components/maintenances_to_page_components.ts`:
   - `maintenance_to_page_component` table with:
     - `maintenanceId` - foreign key with CASCADE delete
     - `pageComponentId` - foreign key with CASCADE delete
     - Composite primary key on both columns
     - `createdAt` timestamp field
   - `maintenancesToPageComponentsRelations` with one-to-one relations to maintenance and pageComponent

3. Updated `packages/db/src/schema/page_components/index.ts` to export the new junction tables

4. Updated `packages/db/src/schema/page_components/page_components.ts`:
   - Added imports for junction tables
   - Extended `pageComponentRelations` with `many` relations to:
     - `statusReportsToPageComponents`
     - `maintenancesToPageComponents`

### Notes:
- Followed existing patterns from `monitorsToStatusReport` and `maintenancesToMonitors`
- All tables and relations are exported through the schema index
- TypeScript type checks pass for the new files

### Next Steps:
- Define relations in related tables (Relations Definition) - add many relations from statusReport and maintenance to the new junction tables
